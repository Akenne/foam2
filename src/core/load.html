<html>
  <head>
    <script>console.time('boot');</script>
    <script>console.time('loadContext');</script>
    <script language="javascript" src="context.js"></script>
    <script>console.timeEnd('loadContext');</script>
    <script>console.time('loadStdlib');</script>
    <script language="javascript" src="stdlib.js"></script>
    <script>console.timeEnd('loadStdlib');</script>
    <script>console.time('loadMM');</script>
    <script language="javascript" src="mm.js"></script>
    <script>console.timeEnd('loadMM');</script>
    <script>console.time('loadSlot');</script>
    <script language="javascript" src="Slot.js"></script>
    <script>console.timeEnd('loadSlot');</script>
    <script>console.time('loadDebug');</script>
    <script language="javascript" src="debug.js"></script>
    <script>console.timeEnd('loadDebug');</script>
    <script>console.timeEnd('boot');</script>
    <title>Load FOAM</title>
  </head>
  <body>
    <script>
      foam.CLASS({
        name: 'TopicTest',
        topics: [ 'onFoo', 'onBar' ],
        properties: [ 'a', 'b', 'c' ]
      });

      var t = TopicTest.create();

      var l = function() { console.log('listener: ', arguments); };
      t.subscribe(l);
      t.publish('test1');
      t.unsubscribe(l);
      t.publish("if you see this, unsubscribe doesn't work");

      t.subscribe('subtopic', l);
      t.publish('subtopic', 'test1');
      t.unsubscribe('subtopic', l);
      t.publish('subtopic', "if you see this, unsubscribe doesn't work");

      t.subscribe(function() { console.log('global: ', arguments); });
      t.subscribe('foo', function() { console.log('foo: ', arguments); });
      t.publish('foo');
      t.publish('bar');
      t.publish('foo', 'bar', 'zoom');

      t.onFoo.publish('data to onFoo');

      t.onFoo.subscribe(function(sub, subTopic, arg1, arg2, arg3) {
        console.log('onFoo: ', sub, 'subTopic: ', subTopic, 'args: ', arg1, arg2, arg3);
      });
      t.onFoo.subscribe('subTopic', function(sub, subTopic, arg1, arg2, arg3) {
        console.log('onFoo.subTopic: ', sub, 'subTopic: ', subTopic, 'args: ', arg1, arg2, arg3);
      });
      t.onFoo.publish('hello', 'world');
      t.onFoo.publish('subTopic', 'hello','world','subTopic');


      t.propertyChange.subscribe(function(sub, subTopic, oldValue,newValue) {
        console.log('propertyChange.global: ', sub, 'subTopic: ', subTopic, oldValue, newValue);
      });

      t.propertyChange.subscribe('a', function(sub, subTopic, oldValue,newValue) {
        console.log('propertyChange.a: ', sub, 'subTopic: ', subTopic, oldValue, newValue);
      });

      t.propertyChange.subscribe('a', function(sub, subTopic, oldValue,newValue) {
        console.log('propertyChange.a-oneTime: ', sub, 'subTopic: ', subTopic, oldValue, newValue);
        sub.destroy();
      });

      t.a = 42;
      t.a++;

      foam.CLASS({
        name: 'ListenerTest',
        properties: [ 'a', 'b', 'c' ],
        listeners: [
          function foo() { console.log('foo.a:',this.a); },
          function bar() { console.log('bar.b:',this.b); },
        ]
      });

      var t2 = ListenerTest.create({a:42,b:84});
      t2.foo();
      t2.bar();
      var foo = t2.foo, bar = t2.bar;
      foo();
      bar();


      foam.CLASS({
        name: 'SampleTrait',
        properties: [ 't1', 't2', 't3' ],
        methods: [
          function tfoo() { console.log('ffoo'); },
          function tbar() { console.log('tbar'); }
        ]
      });

      foam.CLASS({
        name: 'TraitTest',
        traits: ['SampleTrait'],
        properties: [ 'p1', 'p2', 'p3' ],
        methods: [
          function foo() { console.log('foo'); },
          function bar() { console.log('bar'); }
        ]
      });

      TraitTest.describe();
      var tt = TraitTest.create({p1:1, t1:2});
      tt.describe();
      tt.tfoo();
      tt.foo();


      foam.CLASS({
        name: 'Person',
        properties: [
          'name',
          { name: 'sex', defaultValue: 'M' }
        ],
        methods: [
          function toString() { return this.name + ' ' + this.sex; }
        ]
      });
      foam.CLASS({
        name: 'Employee',
        extends: 'Person',
        properties: [
          'salary'
        ],
        methods: [
          function toString() { return this.SUPER() + ' ' + this.salary; }
        ]      });
      foam.CLASS({
        name: 'Nun',
        extends: 'Person',
        properties: [
          { name: 'sex', defaultValue: 'F' }
        ]
      });

      var bob     = Person.create({name: 'Bob'});
      var don     = Employee.create({name: 'Don', salary: 30000});
      var terresa = Nun.create({name: 'Terresa'});
      console.log(bob.toString(), don.toString());
      console.log(bob.sex, don.sex, terresa.sex);
    </script>
  </body>
</html>
