<html>
  <head>
    <script language="javascript" src="stdlib.js"></script>
    <script>console.time('boot');</script>
    <script>console.time('loadContext');</script>
    <script language="javascript" src="context.js"></script>
    <script>console.timeEnd('loadContext');</script>
    <script>console.time('loadStdlib');</script>
    <script language="javascript" src="stdlib.js"></script>
    <script>console.timeEnd('loadStdlib');</script>
    <script>console.time('loadMM');</script>
    <script language="javascript" src="mm.js"></script>
    <script>console.timeEnd('loadMM');</script>
    <script>console.time('loadSlot');</script>
    <script language="javascript" src="Slot.js"></script>
    <script>console.timeEnd('loadSlot');</script>
    <script>console.time('loadDebug');</script>
    <script language="javascript" src="debug.js"></script>
    <script>console.timeEnd('loadDebug');</script>
    <script>console.timeEnd('boot');</script>
    <title>Load FOAM</title>
  </head>
  <body>
    <script>
      CLASS({
        name: 'TopicTest',
        topics: [ 'onFoo', 'onBar' ],
        properties: [ 'a', 'b', 'c' ]
      });

      var t = TopicTest.create();

      t.onFoo.sub(function(sub, subTopic, arg1, arg2, arg3) {
        console.log('onFoo: ', sub, sub.topic.toString(), 'subTopic: ', subTopic, 'args: ', arg1, arg2, arg3);
      });
      t.onFoo.topic('subTopic').sub(function(sub, subTopic, arg1, arg2, arg3) {
        console.log('onFoo.subTopic: ', sub, sub.topic.toString(), 'subTopic: ', subTopic, 'args: ', arg1, arg2, arg3);
      });
      t.onFoo.pub('hello', 'world');
      t.onFoo.topic('subTopic').pub('hello','world','subTopic');

      t.onPropertyChange.sub(function(sub, subTopic, oldValue,newValue) {
        console.log('onPropertyChange.global: ', sub, sub.topic.toString(), 'subTopic: ', subTopic, oldValue, newValue);
      });

      t.onPropertyChange.topic('a').sub(function(sub, subTopic, oldValue,newValue) {
        console.log('onPropertyChange.a: ', sub, sub.topic.toString(), 'subTopic: ', subTopic, oldValue, newValue);
      });

      t.onPropertyChange.topic('a').sub(function(sub, subTopic, oldValue,newValue) {
        console.log('onPropertyChange.a2: ', sub, sub.topic.toString(), 'subTopic: ', subTopic, oldValue, newValue);
      });

      t.onPropertyChange.topic('a').sub(function(sub, subTopic, oldValue,newValue) {
        console.log('onPropertyChange.a-oneTime: ', sub, sub.topic.toString(), 'subTopic: ', subTopic, oldValue, newValue);
        sub.destroy();
      });

      t.a = 42;
      t.b = 84;
      t.a++;
      t.a++;

      CLASS({
        name: 'ListenerTest',
        properties: [ 'a', 'b', 'c' ],
        listeners: [
          function foo() { console.log('foo.a:',this.a); },
          function bar() { console.log('bar.b:',this.b); },
        ]
      });

      var t2 = ListenerTest.create({a:42,b:84});
      t2.foo();
      t2.bar();
      var foo = t2.foo, bar = t2.bar;
      foo();
      bar();


      CLASS({
        name: 'SampleTrait',
        properties: [ 't1', 't2', 't3' ],
        methods: [
          function tfoo() { console.log('ffoo'); },
          function tbar() { console.log('tbar'); }
        ]
      });

      CLASS({
        name: 'TraitTest',
        traits: ['SampleTrait'],
        properties: [ 'p1', 'p2', 'p3' ],
        methods: [
          function foo() { console.log('foo'); },
          function bar() { console.log('bar'); }
        ]
      });

      TraitTest.describe();
      var tt = TraitTest.create({p1:1, t1:2});
      tt.describe();
      tt.tfoo();
      tt.foo();
    </script>
  </body>
</html>
